{
    "history": "Test config for DFOLS algorithm and Vn3 of OptClim. Perturbing 7 parameters ",
    "Developer_comment": "StudyConfig.py provides methods that work with this configuration file. Remember to change them if you change structure of this.",
    "version": 3,
    "version_comment": "Version ID",
    "Name": "dfols_r",
    "Name_comment": "Study Name",
    "baseRunID": "d7",
    "baseRunID_comment": "base for runID. .",
    "run_info": {
        "runTime": 10000,
        "runTime_comment": "Time in seconds for run. Run for a 6 years 4 months should take about 9200 seconds ~ 3 hours.",
        "runCode": "geos_optclim",
        "runCode_comment": "Project code to run job under.",
        "submit_engine": "SGE",
        "submit_engine_comment": "Name of engine to submit runs to. One of SGE or SLURM. MUST be provided ",
	    "ssh_node": "login03.ecdf.ed.ac.uk",
	    "ssh_node_comment":"If not null then name of machine which has access to engine. Will ssh to this machine to submit commands",
        "modelName": "HadCM3",
        "modelName_comment": "Name of model that is ran",
        "maxRuns": null,
        "maxRuns_comment": "Maximum number of runs to do in parallel"
        },
    "run_info_comment": "Information  for run_info. Must include machineName and modelName. Can include other keys for use in submission. Useful ones are runTime, runCode & maxRuns ",
    "optimiseFunction": null,
    "optimiseFunction_comment": "Name of optimisation function to run. null gives default",
    "runUpgrade_vn4": "For vn4 add list of things to do here!",
    "Parameters": {
        "comment": "Information relevant to parameters.",
        "defaultParams": {
            "comment": "Default parameter values for HadAM3. null values or not set mean don't modify. Checked against wiki 11/5/17 ",
            "CT": 0.0001,
            "EACF": 0.5,
            "ENTCOEF": 3.0,
            "ICE_SIZE": 3e-05,
            "RHCRIT": 0.7,
            "VF1": 1.0,
            "CW": 0.0002,
            "CW_comment": "Seed parameter which  affects CW_SEA & CW_LAND",
            "DYNDIFF": 12.0,
            "DYNDIFF_comment": "Seed parameter which affects DIFF_COEFF, DIFF_COEFF_Q, DIFF_EXP & DIFF_EXP_Q",
            "KAY_GWAVE": 20000.0,
            "KAY_GWAVE_comment": "Seed parameter which also affects KAY_LEE_GWAVE",
            "ASYM_LAMBDA": 0.15,
            "CHARNOCK": 0.012,
            "CHARNOCK_comment": "Note this is Murphy et al, 200X and is different from that reported in Yamazaki et al, 2013",
            "G0": 10.0,
            "Z0FSEA": 0.0013,
            "ALPHAM": 0.5,
            "ALPHAM_comment": "Seed parameter which affects DTICE and ALPHAM",
            "START_TIME": null,
            "START_TIME_comment": "Start_time as ISO string (YYYY-MM-DD)",
            "RUN_TARGET": null,
            "RUN_TARGET_comment": "Run target -- as an ISO period string "
        },
        "initParams": {
            "comment": "Intial values for parameters to be optimised. Set to null to use default values. Values below are first 7 for HadAM3-14#1 ",
            "VF1": 1.0,
            "RHCRIT": 0.0,
            "ICE_SIZE": 0.0,
            "ENTCOEF": 1.0,
            "EACF": 0.0,
            "CT": 1.0,
            "CW": 1.0
        },
        "initScale": true,
        "initScale_comment": "If true then startParams range from 0 to 1 where 0 means min value; 1 max value.",
        "fixedParams": {
            "comment": " List of parameters and values that are fixed and not modified in optimisation. Set to null to use default values",
            "START_TIME": "1998-12-01",
            "RUN_TARGET": "P6Y4M"
        },
        "fixedScale": false,
        "fixedScale_comment": "If true then scalable fixedParams range from 0 to 1 where 0 means min value; 1 max value.",
        "minmax": {
            "comment": "Defines the minimum and maximum ranges for the parameters. Must be defined for ALL parameters used in GN optimisation,",
            "CT": [
                5e-05,
                0.0004
            ],
            "EACF": [
                0.5,
                0.7
            ],
            "ENTCOEF": [
                0.6,
                9.0
            ],
            "ICE_SIZE": [
                2.5e-05,
                4e-05
            ],
            "RHCRIT": [
                0.6,
                0.9
            ],
            "VF1": [
                0.5,
                2.0
            ],
            "CW": [
                1e-4,
                2e-3
            ],
            "DYNDIFF": [
                6.0,
                24.0
            ],
            "KAY_GWAVE": [
                10000.0,
                20000.0
            ],
            "ASYM_LAMBDA": [
                0.05,
                0.5
            ],
            "CHARNOCK": [
                0.012,
                0.02
            ],
            "G0": [
                5.0,
                20.0
            ],
            "Z0FSEA": [
                0.0002,
                0.005
            ],
            "ALPHAM": [
                0.5,
                0.65
            ]
        },
        "steps": {
            "comment": "Steps for perturbations -- norm around 10% of the range. If not specified 10% will be used. Values below are from 7 parameter cases described in Tett et al, 2017 (GMDD. They are not particualry optimal",
            "CT": 1e-05,
            "EACF": 0.02,
            "ENTCOEF": 0.15,
            "ICE_SIZE": 1.5e-06,
            "RHCRIT": 0.01,
            "VF1": 0.1,
            "CW": 0.0002,
            "DYNDIFF": 2.0,
            "KAY_GWAVE": 400000.0,
            "ASYM_LAMBDA": 0.15,
            "CHARNOCK": 0.003,
            "G0": 4.0,
            "Z0FSEA": 0.002,
            "ALPHAM": 0.06
        }
    },
    "study": {
        "comment": "Parameters that specify the study. Used by framework and not by optimisation routines",
        "referenceModelDirectory": "$OPTCLIMTOP/Configurations/HadAM3_ed3_SL7_15m",
        "referenceModelDirectory_comment": "Directory where reference model configuration exists. Default is START_DIR/start",
        "covariance": {
            "comment": "Covariance matrices and operations on them. If CovObsErr and CovIntVar are *both* specified then CovTotal will be computed from them",
            "CovTotal": null,
            "CovTotal_Comment": "Name of file containing Covariance Matrix for total Error.",
            "CovTotalDiagonalise": false,
            "CovTotalDiagonalise_comment": "If true diagonalise the total covariance matrix",
            "CovIntVar": "$OPTCLIMTOP/covariance/cov_intvar_20.csv",
            "CovIntVar_Comment": "Name of file containing Covariance Matrix of Internal Variability",
            "CovIntVarDiagonalise": false,
            "CovIntVarDiagonalise_comment": "If true diagonalise the internal variability covariance matrix",
            "CovObsErr": "$OPTCLIMTOP/covariance/cov_obserr_20.csv",
            "CovObsErr_Comment": "Name of file containing Covariance Matrix for Observational Error ",
            "CovObsErrDiagonalise": true,
            "CovObsErrDiagonalise_comment": "If true diagonalise the Observational Error covariance matrix"
        },
        "ObsList": [
            "olr_nhx",
            "rsr_nhx",
            "lat_nhx",
            "lprecip_nhx",
            "mslp_nhx_dgm",
            "temp@500_nhx",
            "rh@500_nhx",
            "olr_tropics",
            "rsr_tropics",
            "lat_tropics",
            "lprecip_tropics",
            "mslp_tropics_dgm",
            "temp@500_tropics",
            "rh@500_tropics",
            "olr_shx",
            "rsr_shx",
            "lat_shx",
            "lprecip_shx",
            "temp@500_shx",
            "rh@500_shx"
        ],
        "ObsList_comment": "List of Observations that Algorithm uses which should be generated by post processing of model",
        "constraintName": "netflux_global",
        "constraintName_comment": "Name of constraint variable -- target value defined by targets/constraintName. "
    },
    "optimise": {
        "comment": "Parameters to control optimisation. This is used within DFOLS optimisation routines AND not by framework",
        "algorithm": "DFOLS",
        "algorithm_comment": "Algorithm wanted.",
        "sigma": true,
        "sigma_comment": "If True use constraint weights",
        "mu": 0.01,
        "mu_comment": "The inverse weighting given to the constraint -- it gets wt 1/(2mu). If Null then no constraint should be applied",
        "dfols":{
        "growing.ndirs_initial": null,
        "growing.ndirs_initial_comment": "the number of perturbations on first iteration. If not specified then will make Nparm perturbtions",
        "rhobeg": 0.18,
        "rhobeg_comment": "Radius of parameter trust region at start",
        "rhoend": 0.1,
        "rhoend_comment": "Radius of paramater trust region for termination (for our purpose this is in normalised parameters)",
        "maxfun": 20,
        "maxfun_comment": "Maximum number of model evaluations to be done. Default is O(1000). reduced to 90 so have data to do a mid-point look at  ",
        "scaling_within_bounds": true,
        "scaling_within_bounds_comment": "Scale internally so all in range 0 to 1",
        "namedSettings": {
            "logging.save_poisedness": true,
            "logging.save_poisedness_comment": "whether or not  to calculate geometry statistics as part of diagnostic information",
            "init.random_initial_directions": true,
            "init.random_initial_directions_comment": "If true perturb in random directions. If false perturb along co-ordinate axis.",
            "init.run_in_parallel": true,
            "init.run_in_parallel_comment": "Run initial cases in parallel",
            "noise.additive_noise_level": 21.0,
            "noise.additive_noise_level_comment": "Estimate of noise in cost function. Used in termination -- nb cost fn is sum of squares **not** sum of squares/nObs. ",
            "logging.save_diagnostic_info": true,
            "logging.save_diagnostic_info_comment": "Save logging info",
            "logging.save_xk": true,
            "logging.save_xk_comment": "Save the full vector of trial values ",
            "noise.quit_on_noise_level": true,
            "noise.quit_on_noise_level_comment": "quit/restart if all trial evaluations are within noise level of last iteration",
            "general.check_objfun_for_overflow": false,
            "general.check_objfun_for_overflow_comment": "Presumably check that function behaves itself",
            "slow.history_for_slow": 2,
            "slow.history_for_slow_comment": "No of past successful iterations to look at to decide if slow or not",
            "slow.thresh_for_slow": 0.1,
            "slow.thresh_for_slow_comment": "Log cost function  change for slow converegence",
            "slow.max_slow_iters": 5,
            "slow.max_slow_iters_comment": "The number of itertions (once slow determined) to decide making slow progress",
            "restarts.use_restarts": true,
            "restarts.use_restarts_comment": "Restart when slow convergence or too noisy",
            "restarts.use_soft_restarts": true,
            "restarts.use_soft_restarts_comment": "Use soft restart -- reuse some existing points when  restarting",
            "restarts.soft.num_geom_steps": 3,
            "restarts.soft.num_geom_steps_comment": "How many extra runs to be done when restarting",
            "restarts.increase_npt": false,
            "restarts.increase_npt_comment": "Increase number of points when restarting",
            "restarts.increase_npt_amt_comment": "Number of points to increase by in restarts.increase_npt set when restarting",
            "restarts.max_unsuccessful_restarts": 100,
            "restarts.max_unsuccessful_restarts_comment": "Number of consecutive restarts allowed when no progress made",
            "restarts.hard.increase_ndirs_initial_amt": 1,
            "restarts.hard.increase_ndirs_initial_amt_comment": "How many points to increase by  when doing hard restart (not using any exisiting pts)",
            "restarts.max_npt": null,
            "restarts.max_npt_comment": "Maximum number of points/model evals in each restart",
            "tr_radius.gamma_dec": 0.8,
            "tr_radius.alpha1": 0.9,
            "tr_radius.alpha2": 0.95
            },
            "NamedSettings_comment": "Settings for named parameters that get passed into dfols via user_params"
        },
        "dfols_comment": "Settings for DFOLS"
    },
    "postProcess": {
        "comment": "Options to control post processing. Details depend on your post processing script.",
        "script": "$OPTCLIMTOP/OptClimVn3/scripts/comp_obs.py",
        "script_comment": "Full path name -- including any environment variables you might have -- to postprocessing script",
        "outputPath": "obs.json",
        "outputPath_comment": "output path relative to model dir -- should be one of .nc, .json or .csv. Default is observations.nc",
        "note": "Specify mask_file -- file where l/s mask is, name of mask, start and end times",
        "mask_file": "/exports/csce/eddie/geos/groups/cesd/umdir/SL7/vn4.5/ancil/atmos/cl_9673/qrparm.mask",
        "mask_file_comment": "Path to mask file. Example value is for N48 HadAM3",
        "mask_name": "land_binary_mask",
        "mask_name_comment": "Name of mask variable. Depends on file..",
        "start_time": "2000-03-01",
        "start_time_comment": "Start time as ISO date",
        "end_time": "2005-03-01",
        "end_time_comment": "End time as ISO date"
    },
    "targets": {
        "comment": "Observed targets for optimisation. Should include constraint value.",
        "rsr_nhx": 102.276779013,
        "rsr_tropics": 94.172585284,
        "rsr_shx": 108.113226173,
        "rsr_gm": 99.5,
        "olr_nhx": 222.981135462,
        "olr_tropics": 259.889979681,
        "olr_shx": 216.123659078,
        "olr_gm": 239.6,
        "lat_nhx": 275.837176497,
        "lat_tropics": 297.551167045,
        "lat_shx": 287.433252179,
        "lprecip_nhx": 1.67274541294e-05,
        "lprecip_tropics": 3.61223235446e-05,
        "lprecip_shx": 2.23188435704e-05,
        "mslp_nhx_dgm": 330.683773931,
        "mslp_tropics_dgm": 178.755937185,
        "temp@500_nhx": 251.407284938,
        "temp@500_tropics": 266.733035653,
        "temp@500_shx": 248.927897989,
        "rh@500_nhx": 53.4221821948,
        "rh@500_tropics": 33.9426666031,
        "rh@500_shx": 52.6728738156,
        "netflux_global": 0.5,
        "netflux_global_comment": "Often used as a constraint.."
    },
    "scalings": {
        "comment": "Scalings on observables -- only defined when not 1.0",
        "lprecip_nhx": 86400.0,
        "lprecip_tropics": 86400.0,
        "lprecip_shx": 86400.0,
        "mslp_nhx_dgm": 0.01,
        "mslp_tropics_dgm": 0.01
    },
    "standardModel": {
        "SimulatedValues": {
            "comment": "Values from Initial Cond ensemble -- used for display",
            "rsr_nhx": 104.828645378,
            "rsr_tropics": 96.1125810912,
            "rsr_shx": 106.220769668,
            "rsr_gm": 100.640785304,
            "olr_nhx": 219.239170954,
            "olr_tropics": 260.168543324,
            "olr_shx": 212.43007422,
            "olr_gm": 238.839351859,
            "lat_nhx": 273.33065608,
            "lat_tropics": 295.525024032,
            "lat_shx": 286.028285954,
            "lprecip_nhx": 1.93355069031e-05,
            "lprecip_tropics": 3.31722810623e-05,
            "lprecip_shx": 2.19885246512e-05,
            "mslp_nhx_dgm": 500.077320213,
            "mslp_tropics_dgm": 145.528208095,
            "temp@500_nhx": 250.103101527,
            "temp@500_tropics": 266.024844065,
            "temp@500_shx": 247.127341727,
            "rh@500_nhx": 57.1694930762,
            "rh@500_tropics": 35.4667676984,
            "rh@500_shx": 57.1532300099,
            "netflux_global": 1.11525220386
        }
    }
}
